<!doctype html>
<html>
<head>
<title>我的收藏 考试系统题库</title>
<#include "common/loadPageJS.ftl" />
</head>

<body>
<#assign current_page="record"/>
<#include "common/item_for_collection.ftl"/>
<#include "common/head.html" />
<div class="main">
	<div class="h30"></div>
	<div class="content fl">
    	<div class="cont-l fl">
        	<div class="box fl yinying">
                <div class="hui-botton"><a href="<@s.url "/library/record/${PRODUCTID}"/>">练习记录</a></div>
                <div class="hui-botton"><a href="<@s.url "/library/error/${PRODUCTID}"/>">错题记录</a></div>
                <div class="dangqian">我的收藏</div>
                <div class="h10"></div>
            </div>
        </div>
        <div class="cont-r fr">
        	<div class="box fl yinying">
                <div class="record fl">
                	<div class="title">我的收藏</div>
                </div>
            </div>
			<#list ITEMLIST as item>
				<#assign xuhao = (item_index+1)/>	<!-- 计算序号 -->
				<@show_item item xuhao/>
			</#list>
        </div>
    </div>
    <div class="h10"></div>
</div>
<#include "common/foot.html" />
</body>
<script type="text/javascript">
	$(function(){
		//<!-- 查看材料 -->
		showCommonTitle = function(id){
			dialog({
				id:'cailiaoDialog',
				title: '查看材料',
				drag: true,
		        content: "<div class='cont-r'><div class='fenxiti fl' style='border:0px'>"+$("div[fenxi_item_id='"+id+"']").html()+"</div></div>"
		    }).show();
		}
		//<!-- 显示收起解析 -->
		toggleAnalysis = function(obj,id){
			var target = $("div[name='jiexi'][item_id='"+id+"']");
			var target2 = $("div[name='answer'][item_id='"+id+"']");
			if(target.is(":hidden")){
				target.show();
				target2.show();
				$(obj).html("收起解析");
				$(obj).parent().siblings("em").attr("class","jiexi-h");
			}else{
				target.hide();
				target2.hide();
				$(obj).html("展开解析");
				$(obj).parent().siblings("em").attr("class","jiexi");
			}
		}
		//<!-- 收藏或取消收藏 -->
		collectOrCancel = function(obj,itemId,userAnswer){
			$.ajax({
				type:"POST",
				url:'<@s.url "/library/item/collect"/>',
				data:{"itemId":itemId},
				dataType:'json',
				success:function(data){
					if(data.success){
						if(data.data == 0) //取消收藏成功
						{
							$(obj).parent().siblings().attr("class","shoucang");
							$(obj).html("收藏");
							showTips(obj,"取消收藏成功!");
						}
						else{
							//$(obj).parent().siblings().attr("class","shoucang-h");
							//$(obj).html("移除此收藏");
							//showTips(obj,"收藏成功，您可以到“练习记录中”去查看收藏的试题！");
							$("div[name='item_whole'][item_id='"+itemId+"']").remove();
						}
					}
				}
			});
		}
		//<!-- 分页 -->
		var pageClick = [];
		showNote = function(structureItemId,itemIndex,model){
			var index = pageClick.length;
			$.ajax({
				type:"POST",
				url:'<@s.url "/library/item/notes"/>',
				data:{"structureItemId":structureItemId,"page":1,"rows":3,"model":model},
				dataType:"json",
				success:function(data){
					if(data.total == 0) return;
					var arr = data.rows;
					var total = data.total%3==0?(data.total/3):(data.total/3+1);
					var contentArea = $("div[name='noteList'][s_item_id='"+structureItemId+"']").find("div[name='content']");
					contentArea.html("");
					$.each(arr,function(i){
						var note = arr[i];
						var html = "<div class='textbook fl'><div class='txt'><div class='pic-bg'><a href='#' target='_blank' title=''></a></div><div class='pic'><img src='<@s.url '/resources/front-default/image/pic2.jpg'/>' width='70' height='70'></div><div class='f-right'><div class='vipname fl'><a href='#' target='_blank' title='note.username'>"+note.username+"</a><span>"+note.time+"</span></div><div class='pinglun fl'>"+note.content+"</div></div></div></div>"
						contentArea.append(html);
					});
					if(data.total<=3){
						$("#pager"+itemIndex).html("");
					}else{
						pageClick[index] = function(pageclickednumber){
							$("#pager"+itemIndex).pager({ pagenumber: pageclickednumber, pagecount: total, buttonClickCallback: pageClick[index] });
							$.ajax({
								type:"POST",
								url:"<@s.url "/library/item/notes"/>",
								data:{"structureItemId":structureItemId,"page":pageclickednumber,"rows":3,"model":model},
								dataType:"json",
								success:function(data){
									if(data.total == 0) return;
									var arr = data.rows;
									var total = data.total%3==0?(data.total/3):(data.total/3+1);
									var contentArea = $("div[name='noteList'][s_item_id='"+structureItemId+"']").find("div[name='content']");
									contentArea.html("");
									$.each(arr,function(i){
										var note = arr[i];
										var html = "<div class='textbook fl'><div class='txt'><div class='pic-bg'><a href='#' target='_blank' title=''></a></div><div class='pic'><img src='<@s.url '/resources/front-default/image/pic2.jpg'/>' width='70' height='70'></div><div class='f-right'><div class='vipname fl'><a href='#' target='_blank' title='note.username'>"+note.username+"</a><span>"+note.time+"</span></div><div class='pinglun fl'>"+note.content+"</div></div></div></div>"
										contentArea.append(html);
									});
								}
							});
						}
						$("#pager"+itemIndex).pager({ pagenumber: 1, pagecount: total, buttonClickCallback: pageClick[index]});
					}
				}
			});	//获取数据
			$("div[name='noteList'][s_item_id='"+structureItemId+"']").show();
		}
		//显示提示
		function showTips(obj,msg){
			var d = dialog({
			    content: msg,
			    quickClose: true// 点击空白处快速关闭
			});
			d.show(obj);
		}
		// 添加笔记
		addNote = function(obj){
			var textarea = $(obj).parent().parent().find("textarea");
			if(!$.trim(textarea.val()) || textarea.val().length<6){
				showTips(obj,"请输入笔记内容(至少5个字)!");
				return;
			}
			$.ajax({
				type:"POST",
				url:"<@s.url "/library/item/addnote"/>",
				data:{"content":textarea.val(),"structureItemId":textarea.attr("s_item_id"),"itemId":textarea.attr("item_id")},
				dataType:"json",
				success:function(data){
					if(data.success){
						var note = data.data;
						var html = "<div class='textbook fl'><div class='txt'><div class='pic-bg'><a href='#' target='_blank' title=''></a></div><div class='pic'><img src='<@s.url '/resources/front-default/image/pic2.jpg'/>' width='70' height='70'></div><div class='f-right'><div class='vipname fl'><a href='#' target='_blank' title='note.username'>"+note.username+"</a><span>"+note.time+"</span></div><div class='pinglun fl'>"+note.content+"</div></div></div></div>"
						var contentArea = $("div[name='noteList'][s_item_id='"+textarea.attr("s_item_id")+"']").find("div[name='content']");
						contentArea.prepend(html);
						$("div[name='noteList'][s_item_id='"+textarea.attr("s_item_id")+"']").show();
						textarea.val("");
					}
				}			
			});
		}
	});
</script>
</html>