<!-- 单题模式 -->
<!doctype html>
<html>
<head>
<title>模拟考场 考试系统题库</title>
<#include "common/loadPageJS.ftl" />
<!-- dialog -->
<link href="<@s.url "/resources/artDialog/ui-dialog.css"/>" rel="stylesheet" type="text/css">
<script type="text/javascript" src="<@s.url "/resources/artDialog/dialog-min.js"/>"></script>
<!-- scrollTo -->
<script type="text/javascript" src="<@s.url "/resources/jquery.scrollTo.js"/>"></script>
</head>

<body>
<#include "common/item.ftl"/>
<#include "common/head.html" />
<div class="main">
	<div class="h30"></div>
	<div class="content fl">
    	<div class="cont-l fl" id="leftArea">
        	<div class="box fl yinying">
            	<div class="time" id="showtime">00:58:28</div>
                <div class="hui-botton"><a href="javascript:void(0)" onclick="pause_do();">暂停</a></div>
                <div class="hui-botton"><a href="#">下次再做</a></div>
                <div class="jiaojuan-botton"><a href="#">提交试卷</a></div>
                <div class="h10"></div>
            </div>
            <div class="box fl yinying">
            	<div class="list">
                	<ul>
                    	<li><a href="javascript:void(0)" onclick="focusTo(null,0)"><em class="shang"></em>上一题</a></li>
                        <li><a href="javascript:void(0)" onclick="focusTo(null,1)"><em class="xia"></em>下一题</a></li>
                        <li><a href="<@s.url "/library/paper/do/multi"/>?paperId=${PAPER.id}"><em class="dan-liang"></em>批量模式</a></li>
                        <li><a href="答案页面.html"><em class="kandaan"></em>查看答案</a></li>
                        <li class="bb-no"><a href="#"><em class="jisuanqi"></em>计算器</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="cont-r fr">
        	<div class="box fl yinying">
            	<div class="daxiao">
                	<div class="list">
                    	<ul>
                        	<li class="out bg" onMouseOver="this.className='over bg'" onMouseOut="this.className='out bg'"><a href="#">小</a></li>
                            <li class="out" onMouseOver="this.className='over'" onMouseOut="this.className='out'"><a href="#">中</a></li>
                            <li class="out" onMouseOver="this.className='over'" onMouseOut="this.className='out'"><a href="#">大</a></li>
                            <li>字体大小:</li>
                        </ul>
                    </div>
                </div>
            	<div class="name"><h1>${PAPER.name}</h1></div>
            </div>
            <div id="questionArea">
            <#list ITEMLIST as item>
            	<div <#if item_index != 0>style="display:none"</#if> single_item_id="${item.id}" id="single${item_index}">
            	<@show_item item item_index+1/>
            	</div>
            </#list>
            </div>
           <div class="datika fl" id="answerCard" style="width:830px;">
            	<div class="ka fl" id="font14">展开答题卡</div>
                <div class="ka-ge fl"></div>
                <div class="ka-box fl" style="display:none">
                	<@answer_card ITEMLIST />
                </div>
            </div>
        </div>
    </div>
    <div class="h30"></div>
</div>
<#include "common/foot.html" />
</body>
<script type="text/javascript">
<!-- 浮动,参数isTop是否距离顶部,否表示距离底部 -->
$.fn.smartFloat = function(isTop) {
	var position = function(element) {
		var top = element.position().top,left =element.position().left, pos = element.css("position");
		var height = $(this).height();
		$(window).scroll(function() {
			var scrolls = $(this).scrollTop();
			var flag;
			if(isTop) flag = scrolls-top;
			else flag = top-height-scrolls;
			if (flag > 0) { //如果滚动到页面超出了当前元素element的相对页面顶部的高度
				if (window.XMLHttpRequest) { //如果不是ie6
					if(isTop) element.css({position: "fixed",left:left,top: 0});
					else
					element.css({
						position: "fixed",
						left:left,
						bottom: 0
					});	
				} else { //如果是ie6
					if(isTop) element.css({position: "absolute",left:left,top: scrolls});
					else
					element.css({
						position: "absolute",
						left:left,
						bottom: 0
					});	
				}
			}else {	//滑到了底部
				if(isTop) element.css({position: pos,left:left,top: top});
				else
				element.css({
					position: pos,
					left:left,
					bottom: top
				});	
			}
		});
	};
	return $(this).each(function() {
		position($(this));						 
	});
};
$(function(){
	//var obj = '${PAPERJSON}';
	//console.info(obj);
	$("#answerCard").smartFloat(false);	//答题卡浮动
	$("#leftArea").smartFloat(1);//左侧浮动
	<!-- 答题卡点击显示  -->
	$("#answerCard div").first().click(function(){
		var card = $(this).siblings("div").last();
		if(card.is(":hidden"))
		{
			$(this).html("隐藏答题卡");
			card.show();
		}
		else{
			$(this).html("展开答题卡");
			card.hide();
		}
	});
	<!-- 点击选项 -->
	$("ul li[option_id]").click(function(){
		var option_id = $(this).attr("option_id");
		if($(this).attr("option_type")=="radio") //互斥
		{
			if($(this).attr("class").indexOf("choose")!=-1) {
				$("li[option_id='"+option_id+"']").attr("class","out");
				$("li[actual][option_id='"+option_id+"']").attr("class","off");
				return;
			}
			$("li[actual][option_id='"+option_id+"']").attr("class","choose");
			$("li[option_id='"+option_id+"']").siblings().attr("class","out");
			$("li[actual][option_id='"+option_id+"']").siblings().attr("class","off");
		}else{
			$("li[actual][option_id='"+option_id+"']").attr("class","choose");
		}
		
	}).mouseout(function(){
		if($(this).attr("actual")){
			if($(this).attr("class")=="choose") return;
			$(this).attr("class","off");
			$("li[option_id='"+$(this).attr("option_id")+"']:not([actual])").attr("class","out");
		}else{
			if($("li[option_id='"+$(this).attr("option_id")+"'][actual]").attr("class")=="choose") return;
			$(this).attr("class","out");
			$("li[option_id='"+$(this).attr("option_id")+"'][actual]").attr("class","off");
		}
	}).mouseover(function(){
		if($(this).attr("actual")){
			if($(this).attr("class")=="choose") return;
			$(this).attr("class","on");
			$("li[option_id='"+$(this).attr("option_id")+"']:not([actual])").attr("class","over");
		}else{
			if($("li[option_id='"+$(this).attr("option_id")+"'][actual]").attr("class")=="choose") return;
			$(this).attr("class","over");
			$("li[option_id='"+$(this).attr("option_id")+"'][actual]").attr("class","on");
		}
		$(this).addClass("over");
	});
	<!-- 字体选择 -->
	$("#fontset li").click(function(){
		if($(this)==$("#fontset li[current='true']")) return;
		$(this).addClass("bg").attr("current",'true');
		$("#paper_body").addClass($(this).attr("id")).removeClass($("#fontset li[current='true']").attr("id"));
		$(this).siblings().removeClass("bg").attr("current",'false');
	});
	<!-- timer -->
	window.limit_time = parseInt('${PAPER.time}')*60;        // 单位：秒
	window.timer         = setInterval(updateTime,1000);                          // 过1秒执行
	function updateTime(){
		/*
		var pause_time = parseInt($('#pause_do').attr('time'));  // 暂停时间
		if (! isNaN(pause_time) ){
			$('#pause_do').attr('time','a');
			var oDateNow = (new Date()).getTime();
			//var aa = parseInt((oDateNow - parseInt(pause_time))/1000);
			console.log('pause_time  not isNaN.');
			window.limit_time = window.limit_time + parseInt((oDateNow - parseInt(pause_time))/1000);
		}
		*/
		if (window.limit_time==300){
			//小于5分钟提示
			alert('请抓紧时间答题');
		}
		if (window.limit_time ==0 ){
			// 停止计时，并自动交卷
			clearInterval(window.timer);
			window.limit_time=0;
			//xc.answer.submit();
		}
		// 转换
		var fillZero = function (num,n){
			var str = ''+num;   //数字转换为字符串
			while(str.length<n){
				str = '0'+str;
			}
			return str;
		};
		var iRemain = window.limit_time;
		//剩余小时
		var iHour = fillZero(parseInt(iRemain/3600),2);
		iRemain%=3600;  //剩下的秒数
		//剩余分钟
		var iMin = fillZero(parseInt(iRemain/60),2);
		iRemain%=60;
		//剩余秒
		var iSec = fillZero(parseInt(iRemain),2);
		var sTime = iHour+':'+iMin+':'+iSec;
		$('#showtime').html(sTime);
		window.limit_time--;
	}
	<!-- 暂停 -->
	pause_do = function(){
		window.clearInterval(timer);
		dialog({
	        content: "<div class='pause'></div>",
	        ok: function () {
	        	window.timer = setInterval(updateTime,1000);   
	            return true;
	        },
	        okValue: '点击继续'
	    }).showModal();
	}
	<!-- 滑动到目标题目 上一题 下一题  -->
	window.current_index = 0;
	focusTo = function(obj,index){
		if(!obj){
			if(index==0)//上一题
			{
				if(current_index == 0){
					showMsg("已经是第一题");
					return;
				}
				current_index = current_index-1;
			}else{
				current_index = current_index+1;
				if($("#single"+current_index).length==0){
					showMsg("已经是最后一题");
					return;
				}
			}
			var target = $("#single"+current_index);
			$(target).show();
			$.scrollTo(target,800,{axis:'xy', offset:-20 });
			$(target).siblings().hide();
			return;
		}
		var target = $("div[single_item_id='"+$(obj).attr("item_id")+"']");
		current_index = target.attr("id");
		$(target).show();
		$.scrollTo(target,800,{axis:'xy', offset:-20 });
		$(target).siblings().hide();
	}
	showMsg = function(msg){
		var d = dialog({
			id:'message',
			content:msg
		}).show();
		var t=setTimeout(function(){
			if(d) d.close().remove();
		},1000);
	}
	<!-- 显示收起解析 -->
	toggleAnalysis = function(obj,id){
		var target = $("div[name='jiexi'][item_id='"+id+"']");
		if(target.is(":hidden")){
			target.show();
			$(obj).html("收起解析");
			$(obj).parent().siblings("em").attr("class","jiexi-h");
		}else{
			target.hide();
			$(obj).html("展开解析");
			$(obj).parent().siblings("em").attr("class","jiexi");
		}
	}
});
</script>
</html>